default:
  context:
    node_name: '@node'
    node: 'cleanWater'
    visitor: 'ant'
  src: ""
  sql: "SELECT nodes.* FROM nodes WHERE nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"
  res: "lake, lakeAddress, opening, status, track, water"

nodes:
  src: "nodes"
  sql: "SELECT nodes.* FROM nodes WHERE nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

pages:
  src: "pages"
  sql: "SELECT nodes.* FROM nodes WHERE nodes.kpath LIKE 'NP%' AND nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"
  res: "status, track"

letters:
  src: "letters"
  sql: "SELECT nodes.* FROM nodes WHERE nodes.kpath LIKE 'NNL%' AND nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

nodes_in_site:
  sql: "SELECT nodes.* FROM nodes WHERE (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

pages_in_project:
  sql: "SELECT nodes.* FROM nodes WHERE nodes.kpath LIKE 'NP%' AND nodes.project_id = #{@node.get_project_id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

nodes_in_section:
  sql: "SELECT nodes.* FROM nodes WHERE nodes.section_id = #{@node.get_section_id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

nodes_in_self:
  sql: "SELECT nodes.* FROM nodes WHERE nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

nodes_in_parent:
  sql: "SELECT nodes.* FROM nodes WHERE nodes.parent_id = #{@node.parent_id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

children:
  sql: "SELECT nodes.* FROM nodes WHERE nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"

pages_or_letters:
  context:
    node: zena
  src:
    - 'pages'
    - 'letters'
  sql: "SELECT nodes.* FROM nodes WHERE ((nodes.kpath LIKE 'NP%' AND nodes.parent_id = #{@node.id}) OR (nodes.kpath LIKE 'NNL%' AND nodes.parent_id = #{@node.id})) AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"
  res: "collections, letter, nature, people, projects, skins"

project:
  sql: "SELECT nodes.* FROM nodes WHERE nodes.id = #{@node.get_project_id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"
  res: 'cleanWater'
  
many_alternatives:
  src:
    - 'tagged in site'
    - 'images in site'
    - 'tags in site'
  sql: "SELECT nodes.*,links.id AS link_id, links.status AS l_status, links.comment AS l_comment FROM nodes,links WHERE ((nodes.id = links.source_id AND links.relation_id = _ID(node_has_tags)) OR (nodes.kpath LIKE 'NDI%' AND links.id = -1) OR (nodes.kpath LIKE 'NPT%' AND links.id = -1)) AND (#{@node.secure_scope('nodes')}) GROUP BY nodes.id ORDER BY nodes.position ASC, nodes.name ASC"
  res: 'art, bird, cleanWater, flower, lake, menu, news, opening, tree'

alternatives_same_join:
  src:
    - 'tagged in site'
    - 'icons'
  sql: "SELECT nodes.*,links.id AS link_id, links.status AS l_status, links.comment AS l_comment FROM nodes,links WHERE ((nodes.id = links.source_id AND links.relation_id = _ID(node_has_tags)) OR (nodes.id = links.target_id AND links.relation_id = _ID(node_has_an_icon) AND links.source_id = #{@node.id})) AND (#{@node.secure_scope('nodes')}) GROUP BY nodes.id ORDER BY nodes.position ASC, nodes.name ASC"
  res: "cleanWater, lake, opening"
  
same_name_as_class:
  context:
    node: 'opening'
  src: "set_tags"
  sql: "SELECT nodes.*,links.id AS link_id, links.status AS l_status, links.comment AS l_comment FROM nodes,links WHERE nodes.id = links.target_id AND links.relation_id = _ID(node_has_tags) AND links.source_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC"
  res: "art, news"

  
notes_in_project:
  res: "opening"
  
vclass_in_project:
  src: "posts in project"
  res: "opening"

vlcass_or_pages:
  src:
    - "posts in project"
    - "pages"
  res: "opening, status, track"

find_relation:
  context:
    node: 'ant'
  src: "favorites"
  res: "nature"

root:
  res: "zena"

site:
  err: "unknown relation 'site'"

pages_from_site_or_images:
  src:
    - 'project from site'
    - 'images'
  err: "unknown relation 'site'"

children_with_order_clause:
  src: "children order by name ASC"
  sql: "SELECT nodes.* FROM nodes WHERE nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY nodes.name ASC"

notes_or_news:
  src:
    - notes
    - news
  sql: "SELECT nodes.*,links.id AS link_id, links.status AS l_status, links.comment AS l_comment FROM nodes,links WHERE ((nodes.kpath LIKE 'NN%' AND nodes.parent_id = #{@node.id} AND links.id = -1) OR (nodes.id = links.source_id AND links.relation_id = _ID(note_has_calendars) AND links.target_id = #{@node.id})) AND (#{@node.secure_scope('nodes')}) GROUP BY nodes.id ORDER BY nodes.position ASC, nodes.name ASC"

news_or_notes:
  src:
    - news
    - notes
  sql: "SELECT nodes.*,links.id AS link_id, links.status AS l_status, links.comment AS l_comment FROM nodes,links WHERE ((nodes.id = links.source_id AND links.relation_id = _ID(note_has_calendars) AND links.target_id = #{@node.id}) OR (nodes.kpath LIKE 'NN%' AND nodes.parent_id = #{@node.id} AND links.id = -1)) AND (#{@node.secure_scope('nodes')}) GROUP BY nodes.id ORDER BY nodes.position ASC, nodes.name ASC"

order_dynattr:
  src: "nodes order by d_assigned ASC, name ASC"
  sql: "SELECT nodes.* FROM nodes,versions LEFT JOIN dyn_attributes ON versions.id = dyn_attributes.owner_id AND dyn_attributes.key = 'assigned' WHERE nodes.id = versions.node_id AND nodes.parent_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) GROUP BY nodes.id ORDER BY dyn_attributes.value ASC, nodes.name ASC"
  res: "lake, lakeAddress, opening, track, water, status"

order_l_status:
  context:
    node: art
  src: "tagged order by l_status ASC, name ASC"
  sql: "SELECT nodes.*,links.id AS link_id, links.status AS l_status, links.comment AS l_comment FROM nodes,links WHERE nodes.id = links.source_id AND links.relation_id = _ID(node_has_tags) AND links.target_id = #{@node.id} AND (#{@node.secure_scope('nodes')}) ORDER BY links.status ASC, nodes.name ASC"
  res: "opening, cleanWater"

paginate:
  src: "nodes in site limit 2 paginate p"
  sql: "SELECT nodes.* FROM nodes WHERE (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC LIMIT 2 OFFSET #{((params[:p].to_i > 0 ? params[:p].to_i : 1)-1)*2}"
  res: "anonymous, ant"

paginate:
  context:
    params:
      p: 2
  src: "nodes in site limit 2 paginate p"
  sql: "SELECT nodes.* FROM nodes WHERE (#{@node.secure_scope('nodes')}) ORDER BY nodes.position ASC, nodes.name ASC LIMIT 2 OFFSET #{((params[:p].to_i > 0 ? params[:p].to_i : 1)-1)*2}"
  res: "art, bird"